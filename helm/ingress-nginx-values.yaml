# NGINX Ingress Controller Helm Values
# Chart: ingress-nginx/ingress-nginx
# Documentation: https://kubernetes.github.io/ingress-nginx/
#
# Optimized for Mac Mini M4 single-node k3d cluster

controller:
  # Service configuration
  service:
    type: LoadBalancer
    ports:
      http: 80
      https: 443
    # External traffic policy
    externalTrafficPolicy: Local

  # Resource limits for Mac Mini optimization
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

  # Single replica for development/small production
  replicaCount: 1

  # Autoscaling (disabled for single node)
  autoscaling:
    enabled: false

  # Metrics for Prometheus
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: monitoring
      additionalLabels:
        release: prometheus

  # Pod disruption budget
  minAvailable: 0

  # Admission webhooks
  admissionWebhooks:
    enabled: true
    failurePolicy: Fail

  # ConfigMap settings for NGINX
  config:
    # Proxy settings
    use-forwarded-headers: "true"
    compute-full-forwarded-for: "true"
    use-proxy-protocol: "false"

    # Timeouts
    proxy-connect-timeout: "10"
    proxy-read-timeout: "120"
    proxy-send-timeout: "120"

    # Body size
    proxy-body-size: "50m"
    client-body-buffer-size: "1m"

    # Logging
    log-format-upstream: '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $request_length $request_time [$proxy_upstream_name] [$proxy_alternative_upstream_name] $upstream_addr $upstream_response_length $upstream_response_time $upstream_status $req_id'

    # Security headers
    enable-modsecurity: "false"
    enable-owasp-modsecurity-crs: "false"

    # SSL settings (for when TLS is enabled)
    ssl-protocols: "TLSv1.2 TLSv1.3"
    ssl-ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384"
    ssl-prefer-server-ciphers: "true"

    # HSTS (enable when using HTTPS)
    # hsts: "true"
    # hsts-max-age: "31536000"
    # hsts-include-subdomains: "true"

    # Real IP handling
    enable-real-ip: "true"

    # Gzip compression
    use-gzip: "true"
    gzip-level: "5"
    gzip-types: "application/atom+xml application/javascript application/x-javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/svg+xml image/x-icon text/css text/plain text/x-component text/javascript text/xml"

  # Ingress class settings
  ingressClassResource:
    name: nginx
    enabled: true
    default: true
    controllerValue: "k8s.io/ingress-nginx"

  # Watch all namespaces
  watchIngressWithoutClass: true

  # Node selector (optional)
  # nodeSelector:
  #   kubernetes.io/os: linux

  # Tolerations (optional)
  # tolerations: []

  # Affinity (optional)
  # affinity: {}

# Default backend (optional)
defaultBackend:
  enabled: false

# TCP/UDP services (optional)
# tcp: {}
# udp: {}

# ServiceAccount
serviceAccount:
  create: true
  name: ""
  automountServiceAccountToken: true

# RBAC
rbac:
  create: true
  scope: false
